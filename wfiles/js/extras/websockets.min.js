function websocketNotify(e){void 0==e&&(e="notify");var n="websocketAudio_"+e.replace(/\//g,""),o=getObject(n);if(void 0!=o)return o.currentTime=0,void o.play();var i=document.createElement("audio");i.id=n,console.log(n);var t=document.createElement("source");t.src=e+".ogg",t.type="audio/ogg",i.appendChild(t),t=document.createElement("source"),t.src=e+".mp3",t.type="audio/mpeg",i.appendChild(t),t=document.createElement("source"),t.src=e+".wav",t.type="audio/wav",i.appendChild(t),document.body.appendChild(i),i.currentTime=0,i.play()}function websocketClient(e,n,o){void 0==o&&(o={}),void 0==o.filter&&(o.filter=""),void 0==o.sound&&(o.sound=""),void 0==o.inp&&(o.inp=1);var i=new websocketConnection(n);return e=getObject(e),i.buildgui(e,o.inp),i.params=o,1==o.inp&&(i.inputwindow.onkeypress=function(e){if(13==e.keyCode&&this.value){i.logmessage('<span class="icon-user w_grey"></span> You: '+this.value);var n={};n.source="user",n.message=this.value,n.icon="icon-user",i.send("message",JSON.stringify(n)),this.value=""}},i.logwindow.onkeypress=function(e){i.inputwindow.focus(),i.inputwindow.value=e.key}),i.bind("open",function(){i.logmessage('<span class="icon-mark w_success"></span> Connected');for(var e in i.params)if("inp"!=e&&"sound"!=e&&0!=i.params[e].length)if("filter"==e)for(var n=i.params[e].split(","),o=0;o<n.length;o++){var t={};t.message="/"+e+" "+n[o],i.send("message",JSON.stringify(t))}else{var t={};t.message="/"+e+" "+i.params[e],i.send("message",JSON.stringify(t))}}),i.bind("close",function(e){i.logmessage('<span class="icon-close w_danger"></span> Disonnected')}),i.bind("message",function(e){i.logmessage(e),i.params.sound.length&&websocketNotify(i.params.sound)}),i.connect(),!1}var websocketConnection=function(e){var n={};this.bind=function(e,o){return n[e]=n[e]||[],n[e].push(o),this},this.send=function(e,n){return this.conn.send(n),this},this.connect=function(){"function"==typeof MozWebSocket?this.conn=new MozWebSocket(e):this.conn=new WebSocket(e),this.conn.onmessage=function(e){o("message",e.data)},this.conn.onclose=function(){o("close",null)},this.conn.onopen=function(){o("open",null)}},this.disconnect=function(){this.conn.close()},this.setfocus=function(){},this.logmessage=function(e){if(void 0==this.logwindow)return!1;var n=document.createElement("div");n.style.borderBottom="1px dashed #ccc",n.style.marginBottom="3px",n.innerHTML=e,this.logwindow.appendChild(n),this.logwindow.scrollTop=this.logwindow.scrollHeight-this.logwindow.clientHeight},this.buildgui=function(e,n){if(void 0==n&&(n=1),e=getObject(e),void 0==e&&(e=document.querySelector(e)),void 0==e)return console.log("websocketConnection gui error - gui object does not exist"+gui),!1;if(this.logwindow=document.createElement("div"),void 0!=e.getAttribute("data-height")){var o=e.getAttribute("data-height");this.logwindow.style.height=o+"px"}else this.logwindow.style.height="300px";this.logwindow.style.overflow="auto",this.logwindow.style.resize="both",this.logwindow.style.backgroundColor="#FFF",this.logwindow.style.border="1px solid #ccc",this.logwindow.style.padding="6px 12px",this.logwindow.style.borderRadius="4px",e.appendChild(this.logwindow),1==n&&(this.inputwindow=document.createElement("input"),this.inputwindow.className="form-control",this.inputwindow.type="text",e.appendChild(this.inputwindow),this.inputwindow.focus())};var o=function(e,o){var i=n[e];if("undefined"!=typeof i)for(var t=0;t<i.length;t++)i[t](o)}};